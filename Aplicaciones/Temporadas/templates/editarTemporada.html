{% extends "./plantilla.html" %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">

      <div class="card shadow-lg rounded-4 border-0">
        <div class="card-header bg-warning text-white text-center rounded-top-4">
          <h3 class="mb-0"><i class="bi bi-pencil-square"></i> Editar Temporada</h3>
        </div>

        <div class="card-body">
          <form method="post" enctype="multipart/form-data" id="frm_editar_temporada" action="{% url 'guardar_edicion_temporada' temporada.id %}">
            {% csrf_token %}

            <div class="form-group mb-3">
              <label for="nombreliga">Nombre de la Liga</label>
              <input class="form-control" type="text" name="nombreliga" id="nombreliga" value="{{ temporada.nombreliga }}" />
            </div>

            <div class="form-group mb-3">
              <label for="nombretorneo">Nombre del Torneo</label>
              <input class="form-control" type="text" name="nombretorneo" id="nombretorneo" value="{{ temporada.nombretorneo }}" />
            </div>

            <div class="form-group mb-3">
              <label for="año">Año</label>
              <input class="form-control" type="number" name="año" id="año" value="{{ temporada.año }}" />
            </div>

            <div class="form-group mb-3">
              <label for="fecha_inicio">Fecha de Inicio</label>
              <input class="form-control" type="date" name="fecha_inicio" id="fecha_inicio" value="{{ temporada.fecha_inicio|date:'Y-m-d' }}" />
            </div>

            <div class="form-group mb-3">
              <label for="fecha_fin">Fecha de Fin</label>
              <input class="form-control" type="date" name="fecha_fin" id="fecha_fin" value="{{ temporada.fecha_fin|date:'Y-m-d' }}" />
            </div>

            {% if temporada.reglamento %}
            <div class="form-group mb-3">
              <label>Reglamento actual</label><br>
              <a href="{% url 'ver_pdf' temporada.id %}" target="_blank" class="btn btn-outline-primary btn-sm">
                Ver Reglamento
              </a>
            </div>
            {% endif %}

            <div class="form-group mb-3">
              <label for="reglamento">Actualizar Reglamento (PDF)</label>
              <input type="file" name="reglamento" id="reglamento" />
            </div>

            <div class="form-group mt-4 d-flex justify-content-center gap-2">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-save-fill"></i> Guardar Cambios
              </button>
              <a href="{% url 'temporadas' %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left-circle-fill"></i> Cancelar
              </a>
            </div>

          </form>
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  $(document).ready(function () {

    // Validar solo números y rango para año
    $.validator.addMethod("anioValido", function(value, element) {
      return this.optional(element) || (/^\d{4}$/.test(value) && value >= 1900 && value <= 2100);
    }, "Ingrese un año válido entre 1900 y 2100");

    $("#frm_editar_temporada").validate({
      rules: {
        nombreliga: {
          required: true,
          minlength: 2,
          maxlength: 100
        },
        nombretorneo: {
          required: true,
          minlength: 2,
          maxlength: 100
        },
        año: {
          required: true,
          digits: true,
          anioValido: true
        },
        fecha_inicio: {
          required: true,
          date: true
        },
        fecha_fin: {
          required: true,
          date: true
        },
        reglamento: {
          extension: "pdf"
        }
      },
      messages: {
        nombreliga: {
          required: "Ingrese el nombre de la liga",
          minlength: "Debe tener al menos 2 caracteres",
          maxlength: "No debe superar los 100 caracteres"
        },
        nombretorneo: {
          required: "Ingrese el nombre del torneo",
          minlength: "Debe tener al menos 2 caracteres",
          maxlength: "No debe superar los 100 caracteres"
        },
        año: {
          required: "Ingrese el año",
          digits: "Solo se permiten números",
          anioValido: "Ingrese un año válido entre 1900 y 2100"
        },
        fecha_inicio: {
          required: "Ingrese la fecha de inicio"
        },
        fecha_fin: {
          required: "Ingrese la fecha de fin"
        },
        reglamento: {
          extension: "Solo archivos PDF permitidos"
        }
      },
      errorPlacement: function(error, element) {
        error.addClass('text-danger mt-1');
        error.insertAfter(element);
      },
      highlight: function(element) {
        $(element).addClass("is-invalid");
      },
      unhighlight: function(element) {
        $(element).removeClass("is-invalid");
      }
    });

    // Plugin para drag and drop PDF (si quieres que sea igual al que usas en equipos)
    $("#reglamento").fileinput({
      theme: "fas",
      language: "es",
      showUpload: false,
      dropZoneEnabled: true,
      browseLabel: "Examinar",
      removeLabel: "Quitar",
      allowedFileExtensions: ["pdf"],
      maxFileSize: 4096,
      msgPlaceholder: "Arrastre o haga clic para seleccionar el archivo PDF",
      showCancel: false,
      showClose: false,
      layoutTemplates: { main2: '{preview} {remove} {browse}' }
    });

  });
</script>
{% endblock %}
