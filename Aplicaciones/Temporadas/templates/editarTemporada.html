{% extends "./plantilla.html" %}
{% block content %}

<div class="row col-md-12 justify-content-center mt-5">
  <div class="col-md-6 bg-light p-4 rounded">
    <h1 class="fa fa-edit mb-4"> Editar Temporada</h1>

    <form action="/temporadas/guardarEdicionTemporada/{{ temporada.id }}/" method="POST" id="frm_editar_temporada" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="form-group">
        <label for="nombreliga">Nombre de la Liga</label>
        <input class="form-control" type="text" name="nombreliga" id="nombreliga" value="{{ temporada.nombreliga }}" />
      </div>

      <div class="form-group">
        <label for="nombretorneo">Nombre del Torneo</label>
        <input class="form-control" type="text" name="nombretorneo" id="nombretorneo" value="{{ temporada.nombretorneo }}" />
      </div>

      <div class="form-group">
        <label for="año">Año</label>
        <input class="form-control" type="text" name="año" id="año" value="{{ temporada.año }}" />
      </div>

      <div class="form-group">
        <label for="fecha_inicio">Fecha de Inicio</label>
        <input class="form-control" type="date" name="fecha_inicio" id="fecha_inicio" value="{{ temporada.fecha_inicio|date:'Y-m-d' }}" />
      </div>

      <div class="form-group">
        <label for="fecha_fin">Fecha de Fin</label>
        <input class="form-control" type="date" name="fecha_fin" id="fecha_fin" value="{{ temporada.fecha_fin|date:'Y-m-d' }}" />
      </div>

      <div class="form-group">
        <label for="reglamento">Reglamento (PDF)</label>
        {% if temporada.reglamento %}
          <p>Archivo actual: <a href="{% url 'ver_pdf' temporada.id %}" target="_blank">{{ temporada.reglamento.name|slice:"7:" }}</a></p>
            <small class="text-white">Sube uno nuevo para reemplazar el actual</small>

        {% endif %}
        <input type="file" name="reglamento" id="reglamento" />
      </div>

      <div class="form-group mt-4">
        <button class="btn btn-outline-success" type="submit">GUARDAR CAMBIOS</button>
        <a href="/temporadas" class="btn btn-outline-danger ml-2">
          <i class="fa fa-chevron-circle-left"></i> Cancelar
        </a>
      </div>
    </form>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  $(document).ready(function () {
    // Validación del formulario
    $("#frm_editar_temporada").validate({
      rules: {
        nombreliga: { required: true, minlength: 2, maxlength: 100 },
        nombretorneo: { required: true, minlength: 2, maxlength: 100 },
        año: { required: true, digits: true, minlength: 4, maxlength: 4 },
        fecha_inicio: { required: true },
        fecha_fin: { required: true },
        reglamento: { extension: "pdf" } // no es obligatorio subir uno nuevo
      },
      messages: {
        nombreliga: {
          required: "Ingrese el nombre de la liga",
          minlength: "Debe tener al menos 2 caracteres",
          maxlength: "No debe superar los 100 caracteres"
        },
        nombretorneo: {
          required: "Ingrese el nombre del torneo",
          minlength: "Debe tener al menos 2 caracteres",
          maxlength: "No debe superar los 100 caracteres"
        },
        año: {
          required: "Ingrese el año",
          digits: "Solo números",
          minlength: "Debe tener 4 dígitos",
          maxlength: "Debe tener 4 dígitos"
        },
        fecha_inicio: {
          required: "Ingrese la fecha de inicio"
        },
        fecha_fin: {
          required: "Ingrese la fecha de fin"
        },
        reglamento: {
          extension: "Sólo se permiten archivos PDF"
        }
      },
    });

    // Bootstrap FileInput para reglamento (no obligatorio)
    $("#reglamento").fileinput({
      language: "es",
      allowedFileExtensions: ["pdf"],
      showCaption: false,
      dropZoneEnabled: true,
      showClose: false,
      showUpload: false
    });
  });
</script>
{% endblock %}
