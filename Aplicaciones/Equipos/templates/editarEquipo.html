{% extends "plantilla.html" %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">

      <div class="card shadow-lg rounded-4 border-0">
        <div class="card-header bg-warning text-white text-center rounded-top-4">
          <h3 class="mb-0"><i class="bi bi-pencil-square"></i> Editar Equipo</h3>
        </div>

        <div class="card-body">
          <form method="post" enctype="multipart/form-data" id="frm_editar_equipo">
            {% csrf_token %}

            <div class="form-group mb-3">
              <label for="nombre">Nombre</label>
              <input class="form-control" type="text" name="nombre" id="nombre"
                     value="{{ form.nombre.value|default:'' }}" />
            </div>

            {% if equipo.logo %}
            <div class="form-group mb-3">
              <label>Logo actual</label><br>
              <img src="{{ equipo.logo.url }}" alt="Logo actual" class="img-thumbnail" style="height: 200px;">
            </div>
            {% endif %}

            <div class="form-group mb-3">
              <label for="logo">Actualizar Logo</label>
              <input type="file" name="logo" id="logo" class="form-control" />
            </div>

            <div class="form-group mb-3">
              <label for="fundacion">Fundación</label>
              <input class="form-control" type="date" name="fundacion" id="fundacion"
                     value="{{ form.fundacion.value|default:'' }}" />
            </div>

            <div class="form-group mb-3">
              <label for="presidente">Presidente</label>
              <input class="form-control" type="text" name="presidente" id="presidente"
                     value="{{ form.presidente.value|default:'' }}" />
            </div>

            <div class="form-group mt-4">
              <button class="btn btn-primary" type="submit">
                <i class="bi bi-save-fill"></i> Guardar Cambios
              </button>
              <a href="/equipos/" class="btn btn-secondary ml-2">
                <i class="bi bi-arrow-left-circle-fill"></i> Cancelar
              </a>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  $(document).ready(function () {
    // Método personalizado solo letras y espacios
    $.validator.addMethod("lettersonly", function (value, element) {
      return this.optional(element) || /^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(value);
    }, "Solo letras y espacios");

    // Validación del formulario
    $("#frm_editar_equipo").validate({
      rules: {
        nombre: {
          required: true,
          minlength: 4,
          maxlength: 10,
          lettersonly: true
        },
        logo: {
          extension: "jpg|jpeg|png|gif|webp"
        },
        fundacion: {
          required: true,
          date: true
        },
        presidente: {
          required: true,
          minlength: 4,
          maxlength: 10,
          lettersonly: true
        }
      },
      messages: {
        nombre: {
          required: "Ingrese el nombre del equipo",
          minlength: "Debe tener al menos 4 caracteres",
          maxlength: "No debe superar los 10 caracteres",
          lettersonly: "Solo se permiten letras y espacios"
        },
        logo: {
          extension: "Formatos permitidos: jpg, jpeg, png, gif, webp"
        },
        fundacion: {
          required: "Ingrese la fecha de fundación"
        },
        presidente: {
          required: "Ingrese el nombre del presidente",
          minlength: "Debe tener al menos 4 caracteres",
          maxlength: "No debe superar los 10 caracteres",
          lettersonly: "Solo se permiten letras y espacios"
        }
      },
      errorPlacement: function (error, element) {
        error.addClass('text-danger mt-1');
        error.insertAfter(element);
      },
      highlight: function (element) {
        $(element).addClass("is-invalid");
      },
      unhighlight: function (element) {
        $(element).removeClass("is-invalid");
      }
    });

    // Plugin para input de logo
    $("#logo").fileinput({
      theme: "fas",
      language: "es",
      showUpload: false,
      dropZoneEnabled: true,
      browseLabel: "Examinar",
      removeLabel: "Quitar",
      allowedFileExtensions: ["jpg", "jpeg", "png", "gif", "webp"],
      maxFileSize: 2048,
      msgPlaceholder: 'Arrastre o clic en examinar',
      showCancel: false,
      showClose: false,
      layoutTemplates: { main2: '{preview} {remove} {browse}' }
    });
  });
</script>
{% endblock %}
