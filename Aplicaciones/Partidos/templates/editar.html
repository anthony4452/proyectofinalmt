{% extends './plantilla.html' %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-header bg-warning text-white text-center rounded-top-4">
          <h4 class="mb-0">
            <i class="fa fa-edit"></i> Editar Partido
          </h4>
        </div>
        <div class="card-body">
          <form method="POST" id="form_editar_partido" action="{% url 'guardar_edicion_partido' partido.id %}">
            {% csrf_token %}

            <div class="form-group mb-3">
              <label for="fecha">Fecha del Partido</label>
              <select class="form-control" name="fecha" id="fecha" required>
                <option value="">Seleccione una fecha</option>
                {% for f in fechas %}
                <option value="{{ f.id }}" {% if f.id == partido.fecha.id %}selected{% endif %}>
                  {{ f.nombre }} - {{ f.temporada.nombretorneo }}
                </option>
                {% endfor %}
              </select>
            </div>

            <div class="row mb-3">
              <div class="col">
                <label for="equipo_local">Equipo Local</label>
                <select class="form-control" name="equipo_local" id="equipo_local" required>
                  <option value="">Seleccione</option>
                  {% for equipo in equipos %}
                  <option value="{{ equipo.id }}" {% if equipo.id == partido.equipo_local.id %}selected{% endif %}>
                    {{ equipo.nombre }}
                  </option>
                  {% endfor %}
                </select>
              </div>
              <div class="col">
                <label for="equipo_visitante">Equipo Visitante</label>
                <select class="form-control" name="equipo_visitante" id="equipo_visitante" required>
                  <option value="">Seleccione</option>
                  {% for equipo in equipos %}
                  <option value="{{ equipo.id }}" {% if equipo.id == partido.equipo_visitante.id %}selected{% endif %}>
                    {{ equipo.nombre }}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col">
                <label for="goles_local">Goles Local</label>
                <input type="number" class="form-control" name="goles_local" id="goles_local" value="{{ partido.goles_local }}" min="0" required>
              </div>
              <div class="col">
                <label for="goles_visitante">Goles Visitante</label>
                <input type="number" class="form-control" name="goles_visitante" id="goles_visitante" value="{{ partido.goles_visitante }}" min="0" required>
              </div>
            </div>

            <div class="form-group mb-3">
              <label for="fecha_realizacion">Fecha de Realización</label>
              <input type="date" class="form-control" name="fecha_realizacion" id="fecha_realizacion" value="{{ partido.fecha_realizacion|date:'Y-m-d' }}" required>
            </div>

            <div class="form-group mt-4 d-flex justify-content-center gap-2">
              <button type="submit" class="btn btn-primary">
                <i class="fa fa-save"></i> Guardar Cambios
              </button>
              <a href="{% url 'lista_partidos' %}" class="btn btn-secondary">
                <i class="fa fa-arrow-left"></i> Cancelar
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  $(document).ready(function () {
    $("#form_editar_partido").validate({
      rules: {
        fecha: { required: true },
        equipo_local: { required: true },
        equipo_visitante: { required: true },
        goles_local: { required: true, digits: true, min: 0 },
        goles_visitante: { required: true, digits: true, min: 0 },
        fecha_realizacion: { required: true, date: true }
      },
      messages: {
        fecha: "Seleccione una fecha",
        equipo_local: "Seleccione un equipo local",
        equipo_visitante: "Seleccione un equipo visitante",
        goles_local: "Ingrese un número válido",
        goles_visitante: "Ingrese un número válido",
        fecha_realizacion: "Seleccione una fecha válida"
      },
      errorPlacement: function (error, element) {
        error.addClass("text-danger mt-1");
        error.insertAfter(element);
      },
      highlight: function (element) {
        $(element).addClass("is-invalid");
      },
      unhighlight: function (element) {
        $(element).removeClass("is-invalid");
      }
    });
  });
</script>
{% endblock %}
